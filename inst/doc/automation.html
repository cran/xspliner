<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Krystian Igras" />

<meta name="date" content="2019-09-24" />

<title>Automate your work</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Automate your work</h1>
<h4 class="author">Krystian Igras</h4>
<h4 class="date">2019-09-24</h4>



<p>This document presents how you can customize xspliner usage to you make it more easier and automated.</p>
<div id="hierarchy-of-parameters" class="section level1">
<h1>Hierarchy of parameters</h1>
<div id="local-transition-and-effect" class="section level2">
<h2>Local transition and effect</h2>
<p>In previous sections we learned how to specify parameters for the effect and transition of single variable. Let‚Äôs name them <strong>local</strong> parameters.</p>
<p>A quick example you can see below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(xspliner)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>rf_iris &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Petal.Width <span class="op">~</span><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species, <span class="dt">data =</span> iris)</span>
<span id="cb1-5"><a href="#cb1-5"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">  </span><span class="kw">xs</span>(Petal.Length, <span class="dt">effect =</span> <span class="kw">list</span>(<span class="dt">grid.resolution =</span> <span class="dv">100</span>), <span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">bs =</span> <span class="st">&quot;cr&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">  </span><span class="kw">xf</span>(Species, <span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">stat =</span> <span class="st">&quot;loglikelihood&quot;</span>, <span class="dt">value =</span> <span class="dv">4</span>)),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="dt">model =</span> rf_iris)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ Sepal.Length + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66137  -0.07612  -0.02611   0.10377   0.45279  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           -1.26770    0.20907  -6.064 1.10e-08 ***
## Sepal.Length           0.03636    0.03515   1.034   0.3027    
## xs(Petal.Length)       1.76230    0.33984   5.186 7.11e-07 ***
## xf(Species)versicolor  0.13297    0.16269   0.817   0.4151    
## xf(Species)virginica   0.44571    0.22056   2.021   0.0451 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03105807)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.5034  on 145  degrees of freedom
## AIC: -88.188
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>When the black box model is based on higher amount of variables it can be problematic to specify local parameters for each predictor. Also formula becomes large and hard to read.</p>
</div>
<div id="global-transition-and-effect" class="section level2">
<h2>Global transition and effect</h2>
<p>Its more common that we use similar configuration for each variable, as it‚Äôs simple and allows us to build and experiment faster. To do this you can specify <code>xs_opts</code> and <code>xf_opts</code> of <code>xspline</code> function. Let‚Äôs name them <strong>global</strong> parameters.</p>
<p>Each of global parameters can specify effect and transition, that should be used for xs and xf transformations respectively. Then you just need to use base xs and xf symbols without parameters:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw">xs</span>(Petal.Length) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span><span class="kw">xf</span>(Species),</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="dt">model =</span> rf_iris, </span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="dt">xs_opts =</span> <span class="kw">list</span>(<span class="dt">effect =</span> <span class="kw">list</span>(<span class="dt">grid.resolution =</span> <span class="dv">100</span>), <span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">bs =</span> <span class="st">&quot;cr&quot;</span>)),</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="dt">xf_opts =</span> <span class="kw">list</span>(<span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">stat =</span> <span class="st">&quot;loglikelihood&quot;</span>, <span class="dt">value =</span> <span class="dv">4</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a>)</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ Sepal.Length + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66137  -0.07612  -0.02611   0.10377   0.45279  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           -1.26770    0.20907  -6.064 1.10e-08 ***
## Sepal.Length           0.03636    0.03515   1.034   0.3027    
## xs(Petal.Length)       1.76230    0.33984   5.186 7.11e-07 ***
## xf(Species)versicolor  0.13297    0.16269   0.817   0.4151    
## xf(Species)virginica   0.44571    0.22056   2.021   0.0451 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03105807)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.5034  on 145  degrees of freedom
## AIC: -88.188
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>But still you can specify local parameters that override the global ones.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw">xs</span>(Sepal.Length, <span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">k =</span> <span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">xs</span>(Petal.Length) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">xf</span>(Species),</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dt">model =</span> rf_iris, </span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="dt">xs_opts =</span> <span class="kw">list</span>(<span class="dt">effect =</span> <span class="kw">list</span>(<span class="dt">grid.resolution =</span> <span class="dv">100</span>), <span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">bs =</span> <span class="st">&quot;cr&quot;</span>)),</span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="dt">xf_opts =</span> <span class="kw">list</span>(<span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">stat =</span> <span class="st">&quot;loglikelihood&quot;</span>, <span class="dt">value =</span> <span class="dv">4</span>))</span>
<span id="cb5-8"><a href="#cb5-8"></a>)</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66224  -0.07961  -0.02923   0.09751   0.45797  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4789     0.2850  -5.189 7.02e-07 ***
## xs(Sepal.Length)        0.4168     0.3465   1.203   0.2310    
## xs(Petal.Length)        1.6848     0.3622   4.651 7.37e-06 ***
## xf(Species)versicolor   0.1562     0.1668   0.936   0.3507    
## xf(Species)virginica    0.4808     0.2276   2.112   0.0364 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03097806)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4918  on 145  degrees of freedom
## AIC: -88.575
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>In this case <code>last_evaluation</code> variable will be transformed with thin plate regression spline (<code>bs = &quot;tp&quot;</code> is default for <code>mgcv::s</code>) with basis dimension equal to <code>10</code>. At the same time <code>average_monthly_hours</code> will be transformed with cubic splines.</p>
<p>What if you forget specifying local and global parameters?</p>
</div>
<div id="default-transition-and-effect" class="section level2">
<h2>Default transition and effect</h2>
<p>As you can see in project objects reference, you may find there <code>xs_opts_edfault</code> and <code>xf_opts_default</code> objects. These objects specify <strong>default</strong> parameters for <code>xs</code> and <code>xf</code> transformations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>xs_opts_default</span></code></pre></div>
<pre><code>## $effect
## $effect$type
## [1] &quot;pdp&quot;
## 
## 
## $transition
## $transition$alter
## [1] &quot;always&quot;
## 
## $transition$monotonic
## [1] &quot;not&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>xf_opts_default</span></code></pre></div>
<pre><code>## $effect
## $effect$type
## [1] &quot;ice&quot;
## 
## 
## $transition
## $transition$alter
## [1] &quot;always&quot;
## 
## $transition$stat
## [1] &quot;GIC&quot;
## 
## $transition$value
## [1] 3</code></pre>
<p>Default parameters are overwritten by global and local ones. So the hierarchy of parameters importance is as follows:</p>
<pre><code>LOCAL &gt; GLOBAL &gt; DEFAULT</code></pre>
<p>But having model based on the huge amount of variables still requires a lot of our work to build the final model. Especially we need to use <code>xs</code> and <code>xf</code> symbols for each variable. How can we make it easier?</p>
</div>
</div>
<div id="automatic-transformation" class="section level1">
<h1>Automatic transformation</h1>
<div id="transform-each-formula-predictor" class="section level2">
<h2>Transform each formula predictor</h2>
<p>If you want to transform each predictor of specified formula and not using xs and xf variables you can omit it using <code>consider</code> parameter for <code>xspline</code> function.</p>
<p>Possible values are <code>&quot;specials&quot;</code> the default one and <code>&quot;all&quot;</code>. For automatic transformation of each variable without specifying <code>xs</code> and <code>xf</code> symbols just set <code>consider = &quot;all&quot;</code> and pass standard formula into <code>xspline</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length  <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species,</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">model =</span> rf_iris,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="dt">consider =</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>)</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)        0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)        1.6579     0.3583   4.627 8.15e-06 ***
## xf(Species)versicolor   0.1689     0.1644   1.027    0.306    
## xf(Species)virginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Then each predictor is transformed with xs and xf symbols and use of default parameters or global ones when specified.</p>
<p><strong><code>xs</code> is used for integer and numeric variables - <code>xf</code> for factors.</strong></p>
<p>By default xspline function tries to extract the data from model (<code>rf_model</code>) call and xspline‚Äôs <code>parent.frame()</code> environment then uses it to determine predictor types. So to be sure that variable types are sourced correctly a good practice here is to add data parameter, storing black box‚Äôs training data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length  <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species,</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">model =</span> rf_iris,</span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">data =</span> iris,</span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="dt">consider =</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>)</span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)        0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)        1.6579     0.3583   4.627 8.15e-06 ***
## xf(Species)versicolor   0.1689     0.1644   1.027    0.306    
## xf(Species)virginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
<div id="transform-only-continuous-or-discrete-variables" class="section level2">
<h2>Transform only continuous or discrete variables</h2>
<p>In some cases you may want to transform only quantitative or qualitative predictors. Looking into default parameters <code>xs_opts_default</code> and <code>xf_opts_default</code> we may find <code>alter</code> parameter for transition.</p>
<p>The parameter is used to specify if predictor for which <code>xs</code> or <code>xf</code> was specified needs to be transformed or used as a bare variable in formula. You can specify it in the local or global transition parameter. In this case using the global one is more reasonable.</p>
<p>So, in order to transform only continuous variables just set <code>alter = &quot;always&quot;</code> (what is default) for <code>xs_opts</code> and <code>alter = &quot;never&quot;</code> for <code>xf_opts</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species,</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="dt">model =</span> rf_iris,</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="dt">data =</span> iris,</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="dt">consider =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="dt">xf_opts =</span> <span class="kw">list</span>(<span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">alter =</span> <span class="st">&quot;never&quot;</span>))</span>
<span id="cb16-6"><a href="#cb16-6"></a>)</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     Species, family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)    0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)    1.6579     0.3583   4.627 8.15e-06 ***
## Speciesversicolor   0.1689     0.1644   1.027    0.306    
## Speciesvirginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>For transformation of factors only:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species,</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="dt">model =</span> rf_iris,</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="dt">data =</span> iris,</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="dt">consider =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="dt">xs_opts =</span> <span class="kw">list</span>(<span class="dt">transition =</span> <span class="kw">list</span>(<span class="dt">alter =</span> <span class="st">&quot;never&quot;</span>))</span>
<span id="cb18-6"><a href="#cb18-6"></a>)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ Sepal.Length + Petal.Length + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.63796  -0.07848  -0.01257   0.09863   0.47749  
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           -0.084592   0.172136  -0.491  0.62387    
## Sepal.Length          -0.001693   0.044135  -0.038  0.96945    
## Petal.Length           0.231921   0.052796   4.393 2.15e-05 ***
## xf(Species)versicolor  0.432659   0.125048   3.460  0.00071 ***
## xf(Species)virginica   0.834121   0.173212   4.816 3.65e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03249376)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.7116  on 145  degrees of freedom
## AIC: -81.41
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Even having learned the above listed options, we still can have problems with handling model with a huge amount of variables.</p>
</div>
<div id="model-based-dot-formula" class="section level2">
<h2>Model based dot formula</h2>
<p>For many existing models in R we usually can specify ‚Äúdot formulas‚Äù, when used predictors are sourced from provided data. xspliner can also handle the form. Let‚Äôs return here for iris random forest model.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>., <span class="dt">model =</span> rf_iris)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)        0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)        1.6579     0.3583   4.627 8.15e-06 ***
## xf(Species)versicolor   0.1689     0.1644   1.027    0.306    
## xf(Species)virginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Good practice here is to provide <code>data</code> parameter as well to detect predictors classes, and model type (classification or regression).</p>
<p>How predictors are sourced?</p>
<p><code>xspline</code> function tries to establish data in the following order (if any way is not possible, it tries the next one):</p>
<ul>
<li>model formula predictors</li>
<li>model training data predictors</li>
<li>xspline provided data parameter, excluding formula response</li>
</ul>
<p>To assure correct predictors usage, you may also specify predictor names vector in <code>predictors</code> parameter, and data (optional) to assure source of variable classes:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(Petal.Width <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb22-2"><a href="#cb22-2"></a>                    <span class="dt">model =</span> rf_iris,</span>
<span id="cb22-3"><a href="#cb22-3"></a>                    <span class="dt">predictors =</span> <span class="kw">colnames</span>(iris)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb22-4"><a href="#cb22-4"></a>                    <span class="dt">data =</span> iris)</span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)        0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)        1.6579     0.3583   4.627 8.15e-06 ***
## xf(Species)versicolor   0.1689     0.1644   1.027    0.306    
## xf(Species)virginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>In above examples each predictor is transformed by default. You can exclude needed, by specifying global <code>alter = &quot;never&quot;</code> parameters, or <code>bare</code>.</p>
<p>This way we are ready to work with many predictors. Can the approach be simpler?</p>
</div>
</div>
<div id="omit-formula" class="section level1">
<h1>Omit formula</h1>
<p>As we could see in previous section, using dot formula the predictors are sourced from provided black box. Why cannot we fully extract formula from black box? We can.</p>
<p>Let‚Äôs use previously built <code>rf_iris</code> model:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>model_xs &lt;-<span class="st"> </span><span class="kw">xspline</span>(rf_iris)</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="kw">summary</span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ xs(Sepal.Length) + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.66641  -0.07500  -0.03058   0.09789   0.46614  
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            -1.4846     0.2875  -5.163 7.87e-07 ***
## xs(Sepal.Length)        0.4397     0.3483   1.262    0.209    
## xs(Petal.Length)        1.6579     0.3583   4.627 8.15e-06 ***
## xf(Species)versicolor   0.1689     0.1644   1.027    0.306    
## xf(Species)virginica    0.4984     0.2246   2.219    0.028 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03099086)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  4.4937  on 145  degrees of freedom
## AIC: -88.513
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Works! Can it be simpler? Actually not because of black box based transformation and theory, but we can provide some model based parameters upfront using DALEX‚Äôs <code>explainer</code> object (see next section).</p>
<p>Unfortunately this simplicity works thanks to a few approaches that randomForest follows.</p>
<p>They are:</p>
<ul>
<li>Building the black box with formula</li>
<li>Black box training data stores factors in long form (the factor is one column, not spread into binary wide form)</li>
</ul>
<p>Most of R based ML models satisfy the above condition. One of exceptions is XGBoost which in actual xspliner version needs to be handled in the more complex xspline call. You can see it in <a href="./cases.html">use cases</a></p>
<div id="excluding-predictors-from-transformation" class="section level2">
<h2>Excluding predictors from transformation</h2>
<p>For this example consider again Boston Housing Data from pdp package, and build simple <code>svm</code> model for predicting <code>chas</code> variable:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">library</span>(pdp)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">library</span>(e1071)</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw">data</span>(boston)</span>
<span id="cb26-4"><a href="#cb26-4"></a>svm_boston &lt;-<span class="st"> </span><span class="kw">svm</span>(chas <span class="op">~</span><span class="st"> </span>cmedv <span class="op">+</span><span class="st"> </span>rad <span class="op">+</span><span class="st"> </span>lstat, <span class="dt">data =</span> boston, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="kw">str</span>(boston[, <span class="st">&quot;rad&quot;</span>])</span></code></pre></div>
<pre><code>##  int [1:506] 1 2 2 3 3 3 5 5 5 5 ...</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">unique</span>(boston<span class="op">$</span>rad)</span></code></pre></div>
<pre><code>## [1]  1  2  3  5  4  8  6  7 24</code></pre>
<p>As we can see <code>rad</code> variable is integer and has only 9 unique values. As a result spline approximation may be misleading, and not possible to perform. We decide here to omit <code>rad</code> variable when performing transformation, nevertheless remaining predictors should be transformed.</p>
<p>At first setup model based transformation:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>xs_model &lt;-<span class="st"> </span><span class="kw">xspline</span>(svm_boston)</span></code></pre></div>
<pre><code>## Error in smooth.construct.tp.smooth.spec(object, dk$data, dk$knots): A term has fewer unique covariate combinations than specified maximum degrees of freedom</code></pre>
<p>As we can see, the error was returned due to the form of <code>rad</code> variable.</p>
<p>How to exclude <code>rad</code> from transformation? We can use xspline‚Äôs <code>bare</code> parameter, responsible for specifying predictor which shouldn‚Äôt be transformed.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>xs_model &lt;-<span class="st"> </span><span class="kw">xspline</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  svm_boston,</span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="dt">bare =</span> <span class="st">&quot;rad&quot;</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="kw">summary</span>(xs_model)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = chas ~ xs(cmedv) + rad + xs(lstat), family = family, 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.8194  -0.3415  -0.3391  -0.3367   2.4276  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -8.734e+01  9.695e+01  -0.901  0.36765   
## xs(cmedv)   -7.638e+01  2.954e+01  -2.586  0.00972 **
## rad         -8.446e-04  2.149e-02  -0.039  0.96864   
## xs(lstat)    1.126e+01  9.231e+01   0.122  0.90294   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 254.5  on 505  degrees of freedom
## Residual deviance: 244.4  on 502  degrees of freedom
## AIC: 252.4
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>As we can see in the summary, rad variable was omitted during transformation.</p>
<p><strong>Note</strong></p>
<p>The option is available only for xspline build on top of model or dot formula.</p>
</div>
</div>
<div id="integration-with-dalex" class="section level1">
<h1>Integration with DALEX</h1>
<p>As mentioned in the previous section, xspliner is integrated with DALEX package. The main function from the package <code>explain</code> returns useful black box data (such as bare black model or training data) that can be used by xspline function.</p>
<p>Just check below example</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">library</span>(DALEX)</span>
<span id="cb34-2"><a href="#cb34-2"></a>rf_boston &lt;-<span class="st"> </span><span class="kw">randomForest</span>(lstat <span class="op">~</span><span class="st"> </span>cmedv <span class="op">+</span><span class="st"> </span>crim <span class="op">+</span><span class="st"> </span>chas, <span class="dt">data =</span> boston)</span>
<span id="cb34-3"><a href="#cb34-3"></a>explainer &lt;-<span class="st"> </span><span class="kw">explain</span>(rf_boston, <span class="dt">label =</span> <span class="st">&quot;boston&quot;</span>)</span></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  boston 
##   -&gt; data              :  506  rows  4  cols ([33mextracted from the model[39m)
##   -&gt; target variable   :  not specified! ([31mWARNING[39m)
##   -&gt; predict function  :  yhat.randomForest  will be used ([33mdefault[39m)
##   -&gt; predicted values  :  numerical, min =  6.107818 , mean =  12.63189 , max =  24.64083  
##   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
## [32mA new explainer has been created![39m</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>model &lt;-<span class="st"> </span><span class="kw">xspline</span>(</span>
<span id="cb36-2"><a href="#cb36-2"></a>  explainer</span>
<span id="cb36-3"><a href="#cb36-3"></a>)</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="kw">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = lstat ~ xs(cmedv) + xs(crim) + xf(chas), 
##     family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -11.3957   -2.3779   -0.6903    1.6758   21.1446  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -16.64606    1.55497 -10.705  &lt; 2e-16 ***
## xs(cmedv)     1.71836    0.07332  23.437  &lt; 2e-16 ***
## xs(crim)      0.59480    0.15480   3.842 0.000137 ***
## xf(chas)1     1.42345    0.69541   2.047 0.041186 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 15.45014)
## 
##     Null deviance: 25752  on 505  degrees of freedom
## Residual deviance:  7756  on 502  degrees of freedom
## AIC: 2827.2
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>You can provide your own xspline‚Äôs parameters that overwrite that sourced from explainer.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
